"use strict";(self.webpackChunkbadger_home=self.webpackChunkbadger_home||[]).push([[978],{1874:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return m},default:function(){return u}});var a=t(7462),i=t(3366),r=(t(7294),t(3905)),l=["components"],o={sidebar_position:4},s="Create a plugin",p={unversionedId:"guides/create-a-plugin",id:"guides/create-a-plugin",isDocsHomePage:!1,title:"Create a plugin",description:"Plugins have three types:",source:"@site/docs/guides/create-a-plugin.md",sourceDirName:"guides",slug:"/guides/create-a-plugin",permalink:"/Badger/docs/guides/create-a-plugin",editUrl:"https://github.com/SLAC-ML/Badger-Home/edit/master/docs/guides/create-a-plugin.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"GUI Usage",permalink:"/Badger/docs/guides/gui-usage"},next:{title:"Implement an extension",permalink:"/Badger/docs/guides/implement-an-extension"}},m=[{value:"Create an algorithm plugin",id:"create-an-algorithm-plugin",children:[],level:2},{value:"Create an interface plugin",id:"create-an-interface-plugin",children:[],level:2},{value:"Create an environment plugin",id:"create-an-environment-plugin",children:[{value:"The basics",id:"the-basics",children:[],level:3},{value:"Advanced topics",id:"advanced-topics",children:[{value:"Specify variable range",id:"specify-variable-range",children:[],level:4},{value:"Incorperate hyper-parameters",id:"incorperate-hyper-parameters",children:[],level:4},{value:"Check variable readout",id:"check-variable-readout",children:[],level:4},{value:"Delayed observation",id:"delayed-observation",children:[],level:4}],level:3}],level:2}],d={toc:m};function u(e){var n=e.components,t=(0,i.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"create-a-plugin"},"Create a plugin"),(0,r.kt)("p",null,"Plugins have three types:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Algorithm: function"),(0,r.kt)("li",{parentName:"ul"},"Interface: class"),(0,r.kt)("li",{parentName:"ul"},"Environment: class")),(0,r.kt)("h2",{id:"create-an-algorithm-plugin"},"Create an algorithm plugin"),(0,r.kt)("h2",{id:"create-an-interface-plugin"},"Create an interface plugin"),(0,r.kt)("h2",{id:"create-an-environment-plugin"},"Create an environment plugin"),(0,r.kt)("p",null,'To let Badger deal with your own optimization problem, you\'ll need to turn the problem into a custom environment plugin first. An environment in Badger defines how Badger could interact with the "control system" upon which the optimization problem forms up. To be more specific, Badger wants to know:'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"What variables can be tuned"),(0,r.kt)("li",{parentName:"ul"},"What are the ranges for the tunable variables"),(0,r.kt)("li",{parentName:"ul"},"What observations are available (objectives, constraints, anything you would like to monitor in the optimization)")),(0,r.kt)("p",null,"Plus (actually more importantly):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"How to tune one variable"),(0,r.kt)("li",{parentName:"ul"},"How to get one observation")),(0,r.kt)("p",null,"And you incorporate those knowledge into Badger by inheriting the ",(0,r.kt)("inlineCode",{parentName:"p"},"Environment")," base class provided by the Badger core, and implementing the corresponding methods."),(0,r.kt)("p",null,"Let's get a better idea about it by creating a simple custom environment plugin for Badger from the ground up."),(0,r.kt)("h3",{id:"the-basics"},"The basics"),(0,r.kt)("p",null,"First off, let's create a file structure like the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:'title="Simplest environment plugin file structure"',title:'"Simplest',environment:!0,plugin:!0,file:!0,'structure"':!0},"|--myenv\n    |--__init__.py\n    |--configs.yaml\n")),(0,r.kt)("p",null,"Here we'll name our simple custom env as ",(0,r.kt)("inlineCode",{parentName:"p"},"myenv"),", as the folder name shows."),(0,r.kt)("p",null,"Then put the boilerplate code below into ",(0,r.kt)("inlineCode",{parentName:"p"},"__init__.py"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="myenv/__init__.py"',title:'"myenv/__init__.py"'},"from badger import environment\nfrom badger.interface import Interface\n\n\nclass Environment(environment.Environment):\n\n    name = 'myenv'\n\n    def __init__(self, interface: Interface, params):\n        super().__init__(interface, params)\n        # Add other logic, try to not do time-consuming stuff here\n\n    @staticmethod\n    def list_vars():\n        return []\n\n    @staticmethod\n    def list_obses():\n        return []\n\n    def _get_var(self, var):\n        return 0\n\n    def _set_var(self, var, x):\n        pass\n\n    def _get_obs(self, obs):\n        return 0\n")),(0,r.kt)("p",null,"Several things to note regarding the boilerplate code:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"It should have a class variable called ",(0,r.kt)("inlineCode",{parentName:"li"},"name"),", and it should match the folder name of the plugin"),(0,r.kt)("li",{parentName:"ul"},"There are 5 methods that are required to be implemented to create a proper Badger env:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"list_vars"),": Get a list of all the supported variables"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"list_obses"),": Get a list of all the supported observations"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"_get_var"),": Get the value of a specific variable"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"_set_var"),": Set a specific variable to some value"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"_get_obs"),": Get the value of a specific observation")))),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"As the comment says, try to avoid doing time-consuming thing in ",(0,r.kt)("inlineCode",{parentName:"p"},"__init__")," method. Badger would create an instance of the environment when users try to get the details of the plugin (say, when ",(0,r.kt)("inlineCode",{parentName:"p"},"badger env myenv")," is called in CLI mode), so just put some light-computing code there in the constructor would provide the users a smoother experience."))),(0,r.kt)("p",null,"Okay, now we can start to implement the methods. Assume that our sample environment has 3 variables: ",(0,r.kt)("inlineCode",{parentName:"p"},"x"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"y"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"z"),", it also has 2 observations: ",(0,r.kt)("inlineCode",{parentName:"p"},"norm"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"mean"),". Then the ",(0,r.kt)("inlineCode",{parentName:"p"},"list_vars")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"list_obses")," methods should look like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"    @staticmethod\n    def list_vars():\n        return ['x', 'y', 'z']\n\n    @staticmethod\n    def list_obses():\n        return ['norm', 'mean']\n")),(0,r.kt)("p",null,"Our custom env is so simple that we don't really need an interface here. Let's implement the getter and setter for the variables:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"    def __init__(self, interface: Interface, params):\n        super().__init__(interface, params)\n        self.variables = {\n            'x': 0,\n            'y': 0,\n            'z': 0,\n        }\n\n    def _get_var(self, var):\n        return self.variables[var]\n\n    def _set_var(self, var, x):\n        self.variables[var] = x\n")),(0,r.kt)("p",null,"Here we use a dictionary called ",(0,r.kt)("inlineCode",{parentName:"p"},"variables")," to hold the values for the variables."),(0,r.kt)("p",null,"Now let's add observation related logic:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"    def _get_obs(self, obs):\n        x = self.variables['x']\n        y = self.variables['y']\n        z = self.variables['z']\n\n        if obs == 'norm':\n            return (x ** 2 + y ** 2 + z ** 2) ** 0.5\n        elif obs == 'mean':\n            return (x + y + z) / 3\n")),(0,r.kt)("p",null,"At this point, the content of ",(0,r.kt)("inlineCode",{parentName:"p"},"__init__.py")," should be:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="myenv/__init__.py"',title:'"myenv/__init__.py"'},"from badger import environment\nfrom badger.interface import Interface\n\n\nclass Environment(environment.Environment):\n\n    name = 'myenv'\n\n    def __init__(self, interface: Interface, params):\n        super().__init__(interface, params)\n        self.variables = {\n            'x': 0,\n            'y': 0,\n            'z': 0,\n        }\n\n    @staticmethod\n    def list_vars():\n        return ['x', 'y', 'z']\n\n    @staticmethod\n    def list_obses():\n        return ['norm', 'mean']\n\n    def _get_var(self, var):\n        return self.variables[var]\n\n    def _set_var(self, var, x):\n        self.variables[var] = x\n\n    def _get_obs(self, obs):\n        x = self.variables['x']\n        y = self.variables['y']\n        z = self.variables['z']\n\n        if obs == 'norm':\n            return (x ** 2 + y ** 2 + z ** 2) ** 0.5\n        elif obs == 'mean':\n            return (x + y + z) / 3\n")),(0,r.kt)("p",null,"Alright! Our little env is almost done -- even though it doesn\u2019t do much, it already has everything that we need for a Badger environment! To make the plugin complete, we should also incorporate some meta data (such as version number) of our env into ",(0,r.kt)("inlineCode",{parentName:"p"},"configs.yaml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python",metastring:'title="myenv/configs.yaml"',title:'"myenv/configs.yaml"'},'---\nname: myenv\nversion: "0.1"\ndependencies:\n  - badger-opt\n')),(0,r.kt)("p",null,"Congrats! Our custom env plugin is ready to go! Let's put the whole folder under ",(0,r.kt)("inlineCode",{parentName:"p"},"BADGER_PLUGIN_ROOT/environments"),", then executing the following command in a terminal (in which the Badger package is available, of course):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"badger env myenv\n")),(0,r.kt)("p",null,"The printouts should look like below. Yay!"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"name: myenv\nversion: '0.1'\ndependencies:\n  - badger-opt\nparams: null\nvariables:\n  - x: 0 -> 1\n  - y: 0 -> 1\n  - z: 0 -> 1\nobservations:\n  - norm\n  - mean\n")),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If you use an older version of Badger, you would encounter the following error when you do ",(0,r.kt)("inlineCode",{parentName:"p"},"badger env myenv"),":"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre"},"Can't instantiate abstract class Environment with abstract method get_default_params\n")),(0,r.kt)("p",{parentName:"div"},"To get around this issue, simply put the following method inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"myenv")," environment class definition:"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-python"},"    @staticmethod\n    def get_default_params():\n        return None\n")),(0,r.kt)("p",{parentName:"div"},"Then you should get the expected printouts. The usage of the ",(0,r.kt)("inlineCode",{parentName:"p"},"get_default_params")," method will be covered in ",(0,r.kt)("a",{parentName:"p",href:"#incorperate-hyper-parameters"},"future sections"),"."))),(0,r.kt)("p",null,"Now you can take ",(0,r.kt)("inlineCode",{parentName:"p"},"myenv")," for a spin -- just write some routine configs and run some algorithm (say, ",(0,r.kt)("inlineCode",{parentName:"p"},"silly")," the random sampler) on our newly created env, to see if everything works as expected."),(0,r.kt)("h3",{id:"advanced-topics"},"Advanced topics"),(0,r.kt)("h4",{id:"specify-variable-range"},"Specify variable range"),(0,r.kt)("h4",{id:"incorperate-hyper-parameters"},"Incorperate hyper-parameters"),(0,r.kt)("h4",{id:"check-variable-readout"},"Check variable readout"),(0,r.kt)("h4",{id:"delayed-observation"},"Delayed observation"))}u.isMDXComponent=!0}}]);